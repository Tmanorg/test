name: Welcome to the team accept the invitation 

on:
  issues:
    types: [opened]

jobs:
  invite-and-close-inhence:
    # Only run if issue has label 'inhence'
    runs-on: ubuntu-latest
    steps:
      - name: Invite Issue Author to Org
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.TESTTOKENS }}
          script: |
            const username = context.payload.issue.user.login;
            const org = 'Tmanorg'; // your org name

            try {
              // Get user ID from username
              const { data: user } = await github.rest.users.getByUsername({ username });
              // Invite user to organization
              await github.request('POST /orgs/{org}/invitations', {
                org: org,
                invitee_id: user.id
              });
              console.log(`Invited ${username} to ${org}`);
            } catch (err) {
              if (err.status === 422) {
                console.log(`User ${username} is already a member or has a pending invite.`);
              } else {
                throw err;
              }
            }
      - name: Close the issue
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.issues.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              state: 'closed'
            });
            console.log('Issue closed!');
